<%- include('./partials/header') %>
<style>
    .polls-container .card {
        margin-top: 20px;
        background-color: #f8f9fa;
        border: 2px solid white;
    }

    .card-header {
        background-color: #424446;
        color: white;
    }

    .progress {
        height: 25px;
        background-color: #d3d3d3;
        border-radius: 20px;
    }

    .progress-bar {
        background-color: #595959; /* Dark gray */
        color: white; /* Text color */
        font-weight: bold;
        border-top-right-radius: 20px;
        border-bottom-right-radius: 20px;
    }

    .list-group-item {
        background-color: #e4e3e365; /* Bright background for list items */
        border: 1px solid #38494d; /* Slight border for definition */
        display: flex;
        align-items: center;
        justify-content: space-between; /* Ensures space between elements */
        padding: 10px;
    }

    .option-text {
        flex: 1; /* Allows text to take up the rest of the space */
        padding-right: 10px; /* Ensures spacing between text and next element */
    }

    .vote-info {
        flex-basis: 100px; /* Fixed space for votes */
        text-align: right; /* Aligns vote info to the right */
        margin-right: 10px; /* Adds a margin between vote info and progress bar */
    }

    .progress-container, .vote-container {
        flex-grow: 1; /* Allows these elements to grow */
        display: flex;
        justify-content: flex-end; /* Aligns the progress bar and vote button to the right */
    }

    .btn-vote {
        padding: 0.375rem 0.75rem; /* Standard Bootstrap padding for buttons */
    }
    #homeButton{
        color: #fff;
        text-decoration: line-through;
        
    }
</style>
<div class="container mt-4">
    <h1>Welcome, <%= loggedInUser.firstName %>!</h1>
    <div class="polls-container">
        <% if (posts.length > 0) { %>
            <% posts.forEach(function(post) { %>
                <div class="card">
                    <div class="card-header">
                        <h3 style="font-family: 'Times New Roman', Times, serif;"><%= post.question %></h3>
                    </div>
                    <ul class="list-group list-group-flush">
                        <% 
                        let totalVotes = post.options.reduce((sum, option) => sum + option.votes, 0);
                        let userHasVoted = post.options.some(option => option.voters.includes(loggedInUser._id));
                        if (userHasVoted) {
                            post.options.forEach(function(option) { 
                                let percentage = totalVotes > 0 ? (option.votes / totalVotes * 100).toFixed(2) : 0; %>
                                <li class="list-group-item">
                                    <div style="font-weight: bold;" class="option-text"><%= option.optionText %></div>
                                    <div class="vote-info"><%= option.votes %> votes</div>
                                    <div class="progress-container">
                                        <div class="progress w-100">
                                            <div class="progress-bar" role="progressbar" style="width: <%= percentage %>%;" aria-valuenow="<%= percentage %>" aria-valuemin="0" aria-valuemax="100"><%= percentage %>%</div>
                                        </div>
                                    </div>
                                </li>
                            <% });
                        } else {
                            post.options.forEach(function(option) { %>
                                <li class="list-group-item">
                                    <div class="option-text"><%= option.optionText %></div>
                                    <div class="vote-container">
                                        <form action="/posts/vote/<%= post._id %>/<%= option._id %>" method="POST">
                                            <button type="submit" class="btn btn-primary btn-sm btn-vote">Vote</button>
                                        </form>
                                    </div>
                                </li>
                            <% });
                        }
                        %>
                    </ul>
                </div>
            <% }); %>
        <% } else { %>
            <div class="alert alert-info" style="background-color: #696767; color: aliceblue;">You have no polls to participate in. Why not create one?</div>
            <a class="btn btn-success" style="color: #000000; background-color: aliceblue;" href="/posts/new">Create a Poll</a>
        <% } %>
    </div>
</div>

<%- include('./partials/footer') %>